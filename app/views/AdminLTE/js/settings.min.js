$(function(){function a(){$(".dappur-save-html").data("html",""),$(".html-modal-title").html(""),$(".tinymce").html(""),tinymce.remove()}$("#import_file").fileupload({dataType:"json",done:function(t,a){"success"==a.result.status?window.location.replace(window.location.href):swal({type:"error",title:a.result.message})}}),$(document).ready(function(){$("#groups_table").DataTable({responsive:!0,stateSave:!0}),1==$("#page").val()?$(".ispage").show():$(".ispage").hide()}),$(document).on("change","#page",function(){1==$(this).val()?$(".ispage").show():$(".ispage").hide()}),$(document).on("change","#add_type",function(){var t=$(this).val();if(6==t)$("#value_input").html('<select name="add_value" id="add_value" class="form-control" required="required"><option value="0">False</option><option value="1">True</option></select>');else if(5==t)$("#value_input").html('<div class="input-group dm-input" data-name="add_value" data-value=""></div>'),DappurMedia.refreshInputs();else if(4==t)$("#value_input").html('<input type="text" name="add_value" id="add_value" class="form-control" value="" placeholder="Value">');else if(3==t)$("#value_input").html('<input type="text" name="add_value" id="add_value" class="form-control" value="" placeholder="Value">');else if(8==t){$("#value_input").html('<input type="text" name="add_value" id="add_value" class="form-control jscolor" value="" placeholder="Value">');var a=document.getElementById("add_value");window.pickeradd=new jscolor(a,{width:243,height:150,borderColor:"#FFF",insetColor:"#FFF",backgroundColor:"#666",hash:!0})}else 2==t?$("#value_input").html('<input type="text" name="add_value" id="add_value" class="form-control" value="" placeholder="Value">'):1==t?$("#value_input").html('<input type="text" name="add_value" id="add_value" class="form-control" value="" placeholder="Value">'):7==t?$("#value_input").html('<div class="row"><div class="col-md-6"><button type="button" class="btn btn-info dappur-html-preview form-control" data-html="add_value">Preview</button><input type="hidden" name="add_value" id="add_value" value=""></div><div class="col-md-6"><button type="button" class="btn btn-warning dappur-html-edit form-control" data-html="add_value">Edit HTML</button></div></div>'):$("#value_input").html('<input type="text" name="add_value" id="add_value" class="form-control" value="" placeholder="Value">')}),$(document).on("click",".dappur-html-preview",function(){var t=$(this).data("html"),a=$("#"+t).val();$(".html-modal-title").html(t),$(".dappur-save-html").hide(),$(".tinymce").html(a),$("#html-modal").modal("show")}),$(document).on("click",".dappur-save-html",function(){var t=$(this).data("html");$("#"+t).val(tinyMCE.activeEditor.getContent()).trigger("change"),a(),$("#html-modal").modal("hide")}),$(document).on("click",".dappur-html-edit",function(){var t=$(this).data("html"),a=$("#"+t).val();$(".html-modal-title").html(t),$(".dappur-save-html").data("html",t),$(".dappur-save-html").show(),$(".tinymce").html(a),tinymce.init({selector:".tinymce",theme:"modern",height:"300",paste_data_images:!0,plugins:["advlist autolink lists link charmap print preview hr anchor pagebreak image","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime nonbreaking save table contextmenu directionality","emoticons template paste textcolor colorpicker textpattern"],toolbar1:"undo redo | styleselect forecolor backcolor | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link | code",toolbar2:"media_local cloudinary",bootstrapConfig:{imagesPath:"/uploads/"},branding:!1,convert_urls:!1,setup:function(t){t.addButton("media_local",{text:"Local Media",icon:!1,onclick:function(){DappurMedia.loadMedia("blog","post_content")}}),hasCloudinary&&t.addButton("cloudinary",{text:"Cloudinary",icon:!1,onclick:function(){DappurCloudinary.loadCloudinary("blog","post_content")}})}}),$("#html-modal").modal("show")}),$("#html-modal").on("hidden.bs.modal",function(){a(),$(".tinymce").html("")});var l='<span class="config-save"><i class="fa fa-check"></i> Save</span> <span class="config-cancel"><i class="fa fa-close"></i> Cancel</span>',n='<span class="config-edit"><i class="fa fa-edit"></i> Edit</span>';$(document).on("click",".config-edit",function(){var t=$(this).parents(".config-button");$(this).parents("label").siblings("input").length&&($(this).parents("label").siblings("input").attr("disabled",!1),t.html(l)),$(this).parents("label").siblings("select").length&&($(this).parents("label").siblings("select").attr("disabled",!1),t.html(l)),$(this).parents("label").siblings(".dm-input").children("input").length&&($(this).parents("label").siblings(".dm-input").children("input").attr("readonly",!1),t.html(l))}),$(document).on("click",".config-cancel",function(){var t=$(this).parents(".config-button"),a=$(this).parents("label").siblings("input");a.length&&(a.attr("disabled",!0),a.val(t.data("default")),a.hasClass("jscolor")||a.hasClass("htmlinput")?(a.hasClass("jscolor")&&a.css("background-color",t.data("default")),a.hasClass("htmlinput")&&a.siblings(".row").children("button").data("html",t.data("default")),t.html("")):t.html(n));var l=$(this).parents("label").siblings("select");l.length&&(l.prop("disabled",!0),l.val(t.data("default")),t.html(n));var e=$(this).parents("label").siblings(".dm-input").children("input");e.length&&(e.prop("readonly",!0),e.val(t.data("default")),t.html(n))}),$(document).on("click",".config-save",function(){var a,t,l=$(this).parents(".config-button");$(this).parents("label").siblings("input").length&&((t={})[(a=$(this).parents("label").siblings("input")).attr("name")]=a.val(),a.attr("disabled",!0));$(this).parents("label").siblings("select").length&&((t={})[(a=$(this).parents("label").siblings("select")).attr("name")]=a.val(),a.prop("disabled",!0));$(this).parents("label").siblings(".dm-input").children("input").length&&((t={})[(a=$(this).parents("label").siblings(".dm-input").children("input")).attr("name")]=a.val(),a.prop("disabled",!0));l.html(' <i class="fa fa-refresh fa-spin"></i> Saving'),DappurCSRF.csrfAjax("/dashboard/settings/save",t,function(t){parsed=jQuery.parseJSON(t),"success"==parsed.status?(l.html('<span class="config-saved"><i class="fa fa-check"></i> Saved</span>'),l.children(".config-saved").fadeOut(2e3,function(){$(this).remove(),a.hasClass("jscolor")||a.hasClass("htmlinput")?l.html(""):l.html(n)}),l.data("default",a.val())):(swal({type:"error",title:parsed.message}),a.hasClass("jscolor")||a.hasClass("htmlinput")?l.html(""):l.html(n),a.val(l.data("default")))})}),$(document).on("change",".dm-image",function(){var t=$(this).parent().siblings("label").children(".config-button"),a=$(this);({})[a.attr("name")]=a.val(),a.attr("disabled",!0),t.html(l)}),$(document).on("change",".jscolor",function(){var t=$(this).siblings("label").children(".config-button"),a=$(this);({})[a.attr("name")]=a.val(),a.attr("disabled",!0),t.html(l)}),$(document).on("change",".htmlinput",function(){var t=$(this).siblings("label").children(".config-button"),a=$(this);({})[a.attr("name")]=a.val(),a.attr("disabled",!0),t.html(l)})});