function MenuEditor(l,s){var o=$("#"+l),r={labelEdit:'<i class="glyphicon glyphicon-edit clickable"></i>',labelRemove:'<i class="glyphicon glyphicon-remove clickable"></i>',textConfirmDelete:"This item will be deleted. Are you sure?",iconPicker:{cols:5,footer:!1},listOptions:{hintCss:{border:"1px dashed #13981D"},opener:{as:"html",close:'<i class="fa fa-minus"></i>',open:'<i class="fa fa-plus"></i>',openerCss:{"margin-right":"10px"},openerClass:"btn btn-success btn-xs"},placeholderCss:{"background-color":"gray"}}};$.extend(!0,r,s);var t=null,n=!0,a=null,i=null,e=r.iconPicker,c=(s=r.listOptions,$("#"+l+"_icon").iconpicker(e));function d(){a[0].reset(),(c=c.iconpicker(e)).iconpicker("setIcon","empty"),i.attr("disabled",!0),t=null,$(".select2").select2({width:"100%"}),$("[data-toggle='toggle']").bootstrapToggle("destroy"),$.each($("[data-toggle='toggle']"),function(e,t){$(this).val("false"),$(this).bootstrapToggle("off")})}function p(e){return $("<a>").addClass(e.classCss).addClass("clickable").attr("href","#").html(e.text)}function f(){var e=$("<div>").addClass("btn-group pull-right"),t=p({classCss:"btn btn-primary btn-xs btnEdit",text:r.labelEdit}),s=p({classCss:"btn btn-danger btn-xs btnRemove",text:r.labelRemove}),l=p({classCss:"btn btn-default btn-xs btnUp btnMove",text:'<i class="glyphicon glyphicon-chevron-up clickable"></i>'}),n=p({classCss:"btn btn-default btn-xs btnDown btnMove",text:'<i class="glyphicon glyphicon-chevron-down clickable"></i>'}),i=p({classCss:"btn btn-default btn-xs btnOut btnMove",text:'<i class="glyphicon glyphicon-save clickable"></i>'}),o=p({classCss:"btn btn-default btn-xs btnIn btnMove",text:'<i class="glyphicon glyphicon-export clickable"></i>'});return e.append(l).append(n).append(o).append(i).append(t).append(s),e}function u(e){$("<span>").addClass("sortableListsOpener "+s.opener.openerClass).css(s.opener.openerCss).on("mousedown",function(e){var t=$(this).closest("li");return t.hasClass("sortableListsClosed")?t.iconOpen(s):t.iconClose(s),!1}).prependTo(e.children("div").first()),e.hasClass("sortableListsOpen")?e.iconOpen(s):e.iconClose(s)}o.sortableLists(r.listOptions),c.on("change",function(e){var t=""!==e.iconClass?e.iconClass+" ":"";a.find("[name=icon]").val(t+e.icon)}),$(document).on("click",".btnRemove",function(e){if(e.preventDefault(),confirm(r.textConfirmDelete)){var t=$(this).closest("ul");$(this).closest("li").remove();var s=!1;void 0!==t.attr("id")&&(s=t.attr("id").toString()===l),t.children().length||s||(t.prev("div").children(".sortableListsOpener").first().remove(),t.remove()),MenuEditor.updateButtons(o)}}),$(document).on("click",".btnEdit",function(e){e.preventDefault(),function(e){var t=e.data();$.each(t,function(e,t){a.find("[name="+e+"]").val(t)}),a.find(".item-menu").first().focus(),t.hasOwnProperty("icon")&&c.iconpicker("setIcon",(s=t.icon,1===(l=s.split(" ")).length?l[0]:2===l.length?l[1]:"empty"));var s,l;i.removeAttr("disabled")}(t=$(this).closest("li")),refreshAddons()}),o.on("click",".btnUp",function(e){e.preventDefault();var t=$(this).closest("li");t.prev("li").before(t),MenuEditor.updateButtons(o)}),o.on("click",".btnDown",function(e){e.preventDefault();var t=$(this).closest("li");t.next("li").after(t),MenuEditor.updateButtons(o)}),o.on("click",".btnOut",function(e){e.preventDefault();var t=$(this).closest("ul"),s=$(this).closest("li");s.closest("ul").closest("li").after(s),t.children().length<=0&&(t.prev("div").children(".sortableListsOpener").first().remove(),t.remove()),MenuEditor.updateButtons(o)}),o.on("click",".btnIn",function(e){e.preventDefault();var t=$(this).closest("li"),s=t.prev("li");if(0<s.length)if(0<(l=s.children("ul")).length)l.append(t);else{var l=$("<ul>");s.append(l),l.append(t),s.addClass("sortableListsOpen"),u(s)}MenuEditor.updateButtons(o)}),this.setForm=function(e){a=e},this.getForm=function(){return a},this.setUpdateButton=function(e){(i=e).attr("disabled",!0),t=null},this.getUpdateButton=function(){return i},this.getCurrentItem=function(){return t},this.update=function(){var e=this.getCurrentItem();if(null!==e){var t=e.data("icon");a.find(".item-menu").each(function(){e.data($(this).attr("name"),$(this).val())}),e.children().children("i").removeClass(t).addClass(e.data("icon")),e.find("span.txt").first().text(e.data("text")),d()}},this.clearForm=function(){d()},this.add=function(){var e={};a.find(".item-menu").each(function(){e[$(this).attr("name")]=$(this).val()});var t=f(),s=$("<span>").addClass("txt").text(e.text),l=$("<i>").addClass(e.icon),n=$("<div>").append(l).append("&nbsp;").append(s).append(t),i=$("<li>").data(e);i.addClass("list-group-item").append(n),o.append(i),MenuEditor.updateButtons(o),d()},this.getString=function(){var e=o.sortableListsToJson();return JSON.stringify(e)},this.setData=function(e){var t=Array.isArray(e)?e:function(e){try{var t=JSON.parse(e)}catch(e){return console.log("The string is not a json valid."),null}return t}(e);if(null!==t){o.empty();var s=function d(e,t){var p=void 0===t?0:t,u=0===p?o:$("<ul>");return $.each(e,function(e,t){var s=void 0!==t.children&&$.isArray(t.children),l={text:"",href:"",icon:"empty",target:"_self",title:""},n=$.extend({},t);s&&delete n.children,$.extend(l,n);var i=$("<li>").addClass("list-group-item");i.data(l);var o=$("<div>").css("margin-bottom","5px"),r=$("<i>").addClass(t.icon),a=$("<span>").addClass("txt").append(t.text),c=f();o.append(r).append("&nbsp;").append(a).append(c),i.append(o),s&&i.append(d(t.children,p+1)),u.append(i)}),u}(t);n?o.find("li").each(function(){var e=$(this);e.children("ul").length&&u(e)}):(s.sortableLists(r.listOptions),n=!0),MenuEditor.updateButtons(o)}}}!function(C){C.fn.sortableLists=function(e){var t=this,s=C("body").css("position","relative"),l={currElClass:"",placeholderClass:"",placeholderCss:{position:"relative",padding:0},hintClass:"",hintCss:{display:"none",position:"relative",padding:0},hintWrapperClass:"",hintWrapperCss:{},baseClass:"",baseCss:{position:"absolute",top:0-parseInt(s.css("margin-top")),left:0-parseInt(s.css("margin-left")),margin:0,padding:0,"z-index":2500},opener:{active:!0,as:"html",open:"",close:"",openerCss:{float:"left",display:"inline-block","background-position":"center center","background-repeat":"no-repeat"},openerClass:""},listSelector:"ul",listsClass:"",listsCss:{},insertZone:50,insertZonePlus:!1,scroll:20,ignoreClass:"clickable",isAllowed:function(e,t,s){return!0},onDragStart:function(e,t){return!0},onChange:function(e){return!0},complete:function(e){return MenuEditor.updateButtons(t),!0}},d=C.extend(!0,{},l,e),p=C("<"+d.listSelector+" />").prependTo(s).attr("id","sortableListsBase").css(d.baseCss).addClass(d.listsClass+" "+d.baseClass),u=C("<li />").attr("id","sortableListsPlaceholder").css(d.placeholderCss).addClass(d.placeholderClass),f=C("<li />").attr("id","sortableListsHint").css(d.hintCss).addClass(d.hintClass),r=C("<"+d.listSelector+" />").attr("id","sortableListsHintWrapper").addClass(d.listsClass+" "+d.hintWrapperClass).css(d.listsCss).css(d.hintWrapperCss),a=C("<span />").addClass("sortableListsOpener "+d.opener.openerClass).css(d.opener.openerCss).on("mousedown",function(e){var t=C(this).closest("li");return t.hasClass("sortableListsClosed")?t.iconOpen(d):t.iconClose(d),!1});"class"===d.opener.as?a.addClass(d.opener.close):"html"===d.opener.as&&a.html(d.opener.close);var h={isDragged:!1,isRelEFP:null,oEl:null,rootEl:null,cEl:null,upScroll:!1,downScroll:!1,pX:0,pY:0,cX:0,cY:0,isAllowed:!0,e:{pageX:0,pageY:0,clientX:0,clientY:0},doc:C(document),win:C(window)};if(d.opener.active){if(!d.opener.open)throw"Opener.open value is not defined. It should be valid url, html or css class.";if(!d.opener.close)throw"Opener.close value is not defined. It should be valid url, html or css class.";C(this).find("li").each(function(){var e=C(this);e.children(d.listSelector).length&&(a.clone(!0).prependTo(e.children("div").first()),e.hasClass("sortableListsOpen")?e.iconOpen(d):e.iconClose(d))})}return this.on("mousedown",function(e){var t=C(e.target);if(!(!1!==h.isDragged||d.ignoreClass&&t.hasClass(d.ignoreClass))){e.preventDefault();var s=t.closest("li"),l=C(this);s[0]&&(d.onDragStart(e,s),function(e,t,s){h.isDragged=!0;var l=parseInt(t.css("margin-top")),n=parseInt(t.css("margin-bottom")),i=parseInt(t.css("margin-left")),o=parseInt(t.css("margin-right")),r=t.offset(),a=t.innerHeight();h.rootEl={el:s,offset:s.offset(),rootElClass:s.attr("class")},h.cEl={el:t,mT:l,mL:i,mB:n,mR:o,offset:r},h.cEl.xyOffsetDiff={X:e.pageX-h.cEl.offset.left,Y:e.pageY-h.cEl.offset.top},h.cEl.el.addClass("sortableListsCurrent "+d.currElClass),t.before(u);var c=h.placeholderNode=C("#sortableListsPlaceholder");t.css({width:t.width(),position:"absolute",top:r.top-C(window).scrollTop()-l,left:r.left-C(window).scrollLeft()-i}).prependTo(p),c.css({display:"block",height:a}),f.css("height",a),h.doc.on("mousemove",v).on("mouseup",g)}(e,s,l))}});function v(e){if(h.isDragged){var t=h.cEl,s=h.doc,l=h.win;e.pageX||((o=e).pageY=h.pY,o.pageX=h.pX,o.clientY=h.cY,o.clientX=h.cX),s.scrollTop()>h.rootEl.offset.top-10&&e.clientY<50?h.upScroll?(e.pageY=e.pageY-d.scroll,C("html, body").each(function(e){C(this).scrollTop(C(this).scrollTop()-d.scroll)}),c(e)):function(e){if(h.upScroll)return;h.upScroll=setInterval(function(){h.doc.trigger("mousemove")},50)}():s.scrollTop()+l.height()<h.rootEl.offset.top+h.rootEl.el.outerHeight(!1)+10&&l.height()-e.clientY<50?h.downScroll?(e.pageY=e.pageY+d.scroll,C("html, body").each(function(e){C(this).scrollTop(C(this).scrollTop()+d.scroll)}),c(e)):function(e){if(h.downScroll)return;h.downScroll=setInterval(function(){h.doc.trigger("mousemove")},50)}():b(h),h.oElOld=h.oEl,t.el[0].style.visibility="hidden",h.oEl=oEl=function(e,t){if(!document.elementFromPoint)return null;var s=h.isRelEFP;if(null===s){var l,n;0<(l=h.doc.scrollTop())&&(s=null==(n=document.elementFromPoint(0,l+C(window).height()-1))||"HTML"===n.tagName.toUpperCase()),0<(l=h.doc.scrollLeft())&&(s=null==(n=document.elementFromPoint(l+C(window).width()-1,0))||"HTML"===n.tagName.toUpperCase())}s&&(e-=h.doc.scrollLeft(),t-=h.doc.scrollTop());var i=C(document.elementFromPoint(e,t));{if(!h.rootEl.el.find(i).length)return null;if(i.is("#sortableListsPlaceholder")||i.is("#sortableListsHint"))return null;if(!i.is("li"))return(i=i.closest("li"))[0]?i:null;if(i.is("li"))return i}}(e.pageX,e.pageY),t.el[0].style.visibility="visible",function(e,t){var s=t.oEl;if(!s||!t.oElOld)return;var l=s.outerHeight(!1),n=e.pageY-s.offset().top;d.insertZonePlus?n<14?function(e,t,s){C("#sortableListsHintWrapper",h.rootEl.el).length&&f.unwrap();if(!s&&e.pageX-t.offset().left>d.insertZone){var l=t.children(),n=t.children(d.listSelector).first();if(n.children().first().is("#sortableListsPlaceholder"))return f.css("display","none");n.length?n.prepend(f):(l.first().after(f),f.wrap(r)),h.oEl&&t.iconOpen(d)}else{if(t.prev("#sortableListsPlaceholder").length)return f.css("display","none");t.before(f)}f.css("display","block"),h.isAllowed=d.isAllowed(h.cEl.el,f,f.parents("li").first())}(e,s,n<7):l-14<n&&function(e,t,s){C("#sortableListsHintWrapper",h.rootEl.el).length&&f.unwrap();if(!s&&e.pageX-t.offset().left>d.insertZone){var l=t.children(),n=t.children(d.listSelector).last();if(n.children().last().is("#sortableListsPlaceholder"))return f.css("display","none");n.length?l.last().append(f):(t.append(f),f.wrap(r)),h.oEl&&t.iconOpen(d)}else{if(t.next("#sortableListsPlaceholder").length)return f.css("display","none");t.after(f)}f.css("display","block"),h.isAllowed=d.isAllowed(h.cEl.el,f,f.parents("li").first())}(e,s,l-7<n):n<5?function(e,t){C("#sortableListsHintWrapper",h.rootEl.el).length&&f.unwrap();if(e.pageX-t.offset().left<d.insertZone){if(t.prev("#sortableListsPlaceholder").length)return f.css("display","none");t.before(f)}else{var s=t.children(),l=t.children(d.listSelector).first();if(l.children().first().is("#sortableListsPlaceholder"))return f.css("display","none");l.length?l.prepend(f):(s.first().after(f),f.wrap(r)),h.oEl&&t.iconOpen(d)}f.css("display","block"),h.isAllowed=d.isAllowed(h.cEl.el,f,f.parents("li").first())}(e,s):l-5<n&&function(e,t){C("#sortableListsHintWrapper",h.rootEl.el).length&&f.unwrap();if(e.pageX-t.offset().left<d.insertZone){if(t.next("#sortableListsPlaceholder").length)return f.css("display","none");t.after(f)}else{var s=t.children(),l=t.children(d.listSelector).last();if(l.children().last().is("#sortableListsPlaceholder"))return f.css("display","none");l.length?s.last().append(f):(t.append(f),f.wrap(r)),h.oEl&&t.iconOpen(d)}f.css("display","block"),h.isAllowed=d.isAllowed(h.cEl.el,f,f.parents("li").first())}(e,s)}(e,h),n=e,(i=h.cEl).el.css({position:"fixed",top:n.clientY-i.xyOffsetDiff.Y-i.mT,left:n.clientX-i.xyOffsetDiff.X-i.mL})}var n,i,o}function g(e){var s=h.cEl,l=C("#sortableListsHint",h.rootEl.el),n=f[0].style,i=null,o=!1,r=C("#sortableListsHintWrapper");"block"===n.display&&l.length&&h.isAllowed?(i=l,o=!0):(i=h.placeholderNode,o=!1),offset=i.offset(),s.el.animate({left:offset.left-C(window).scrollLeft()-h.cEl.mL,top:offset.top-C(window).scrollTop()-h.cEl.mT},250,function(){var e,t;t=(e=s).el[0].style,e.el.removeClass(d.currElClass+" sortableListsCurrent"),t.top="0",t.left="0",t.position="relative",t.width="auto",i.after(s.el[0]),i[0].style.display="none",n.display="none",l.remove(),r.removeAttr("id").removeClass(d.hintWrapperClass),r.length&&r.prev("div").append(a.clone(!0)),o?h.placeholderNode.slideUp(150,function(){h.placeholderNode.remove(),m(),d.onChange(s.el),d.complete(s.el),h.isDragged=!1}):(h.placeholderNode.remove(),m(),d.complete(s.el),h.isDragged=!1)}),b(h),h.doc.unbind("mousemove",v).unbind("mouseup",g)}function c(e){h.pY=e.pageY,h.pX=e.pageX,h.cY=e.clientY,h.cX=e.clientX}function b(e){clearInterval(e.upScroll),clearInterval(e.downScroll),e.upScroll=e.downScroll=!1}function m(){C(d.listSelector,h.rootEl.el).each(function(e){C(this).children().length||(C(this).prev("div").children(".sortableListsOpener").first().remove(),C(this).remove())})}},C.fn.iconOpen=function(e){this.removeClass("sortableListsClosed").addClass("sortableListsOpen"),this.children("ul").css("display","block");var t=this.children("div").children(".sortableListsOpener").first();"html"===e.opener.as?t.html(e.opener.close):"class"===e.opener.as&&t.addClass(e.opener.close).removeClass(e.opener.open)},C.fn.iconClose=function(e){this.removeClass("sortableListsOpen").addClass("sortableListsClosed"),this.children("ul").css("display","none");var t=this.children("div").children(".sortableListsOpener").first();"html"===e.opener.as?t.html(e.opener.open):"class"===e.opener.as&&t.addClass(e.opener.open).removeClass(e.opener.close)},C.fn.sortableListsToJson=function(){var l=[];return C(this).children("li").each(function(){var e=C(this),t=e.data();l.push(t);var s=e.children("ul,ol").sortableListsToJson();0<s.length?t.children=s:delete t.children}),l},C.fn.updateButtons=function(e){var t=void 0===e?0:e,s=["Up","In"],l=["Down"];0===t&&(s.push("Out"),l.push("Out"),C(this).children("li").hideButtons(["Out"])),C(this).children("li").each(function(){var e=C(this).children("ul");0<e.length&&e.updateButtons(t+1)}),C(this).children("li:first").hideButtons(s),C(this).children("li:last").hideButtons(l)},C.fn.hideButtons=function(e){for(var t=0;t<e.length;t++)C(this).find(".btn-group:first").children(".btn"+e[t]).hide()}}(jQuery),MenuEditor.updateButtons=function(e){e.find(".btnMove").show(),e.updateButtons()};