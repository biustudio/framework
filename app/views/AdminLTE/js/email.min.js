$(function(){$(document).ready(function(){var s;CKEDITOR.config.extraPlugins="justify,colordialog",CKEDITOR.on("instanceReady",function(t){t.editor.on("focus",function(t){s="html"})}),CKEDITOR.replace("html",{skin:"kama"}),$(".cke_editable").focus(function(){}),$("#plain_text").focus(function(){s="plain_text"}),$("#subject").focus(function(){s="subject"}),$(document).on("click",".placeholder-insert",function(){if("html"==s&&CKEDITOR.instances.html.insertHtml($(this).attr("data-insert")),"plain_text"==s){var t=(n=jQuery("#plain_text"))[0].selectionStart,e=n.val();n.val(e.substring(0,t)+$(this).attr("data-insert")+e.substring(t))}if("subject"==s){var n;t=(n=jQuery("#subject"))[0].selectionStart,e=n.val();n.val(e.substring(0,t)+$(this).attr("data-insert")+e.substring(t))}}),$(document).on("click","#add-placeholder-custom",function(){swal({title:"Add Custom Data Field",input:"text",showCancelButton:!0,confirmButtonText:"Submit",showLoaderOnConfirm:!0,preConfirm:function(n){return new Promise(function(t,e){n==n.match("^[a-z0-9_]*$")?($("#custom-placeholder-row").is(":visible")||$("#custom-placeholder-row").show(),$("#custom-placeholder-row").append('<div style="float: left; margin: 5px;"><span class="btn btn-default placeholder-insert placeholder-custom" data-insert="{{ '+n+' }}">{{ '+n+' }}</span><span class="btn btn-danger placeholder-delete"><i class="fa fa-close"></i></span><input type="hidden" name="placeholders[]" value="'+n+'"></div>'),t()):e("Data field be alphanumeric with underscores.")})},allowOutsideClick:!1}).then(function(t){swal({type:"success",title:"Custom Data Field Added!",html:"[[ "+t+" ]]"}),$("body").getNiceScroll().resize()})}),$(document).on("click",".placeholder-delete",function(){$(this).parent().remove(),1==$("#custom-placeholder-row").children().length&&($("#custom-placeholder-row").hide(),$("body").getNiceScroll().resize())}),$(document).on("mousedown","#plain_text, #cke_1_resizer",function(t){$(document).mousemove(function(){$("body").getNiceScroll().resize()})}),$(document).on("click","#send-test",function(t){var s=$("#subject").val(),a=CKEDITOR.instances.html.getData(),o=$("#plain_text").val();swal({title:"Would you like to send a test email to yourself?",type:"question",showCancelButton:!0,confirmButtonText:"Send",showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(e,n){DappurCSRF.csrfAjax("/dashboard/email/test",{subject:s,html:a,plain_text:o},function(t){parsed=jQuery.parseJSON(t),"error"==parsed.status?n("An error occurred sending your test email."):e()})})},allowOutsideClick:!1}).then(function(){swal({type:"success",title:"Test mail has been successfully sent."})})}),$("#send_to").select2({width:"100%",ajax:{url:"/dashboard/email/search-users",data:function(t){return{search:t.term}},processResults:function(t,e){if("success"==t.status)return{results:$.map(t.results,function(t){return{text:t.first_name+" "+t.last_name+" ("+t.email+")",id:t.id}})};if(n=e.term,/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(n).toLowerCase())){new Option(e.term,e.term,!0,!0);return{results:[{id:e.term,text:e.term}]}}return!1;var n}}})})});