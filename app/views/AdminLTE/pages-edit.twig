{% extends 'base.twig' %}

{% block title %}{{config['site-name']}} || Add Custom Page{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2-bootstrap-theme/0.1.0-beta.10/select2-bootstrap.min.css">
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{asset('AdminLTE/css/grideditor.min.css')}}" />
{% endblock %}

{% block body %}
        <div class="col-lg-12 content-header">
            <h1 class="page-header">Edit Page</h1>
            <ol class="breadcrumb">
                <li>
                    <i class="fa fa-dashboard"></i> Dashboard
                </li>
                <li>
                    <i class="fa fa-book"></i> Pages
                </li>
                <li class="active">
                    <i class="fa fa-edit"></i> Edit Page
                </li>
            </ol>
        </div>

        <div class="col-lg-12">
            <div class="box panel-primary">
                <div class="box-header">
                    <h3 class="box-title">Edit {{route.name}}</h3>
                </div>
                <form action="{{ currentRoute }}" method="POST" role="form">
                    <div class="box-body">
                        
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-md-3">
                                    <legend>Details</legend>
                                    <div class="form-group{% if has_error('name') %} has-error{% endif %}">
                                        <label for="name">Name</label>
                                        <input type="text" name="name" class="form-control" id="name" placeholder="Name" value="{% if requestParams.name %}{{requestParams.name}}{% else %}{{ route.name }}{% endif %}" required="required">
                                        <span class="help-block">{{ error('name') }}</span>
                                    </div>
                                    <div class="form-group{% if has_error('pattern') %} has-error{% endif %}">
                                        <label for="pattern">Route</label>
                                        <input type="text" name="pattern" class="form-control" id="pattern" placeholder="Route" value="{% if requestParams.pattern %}{{requestParams.pattern}}{% else %}{{ route.pattern }}{% endif %}" required="required">
                                        <span class="help-block">{{ error('pattern') }}</span>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-xs-6{% if has_error('permission') %} has-error{% endif %}">
                                            <label for="permission">Limit to Permission</label>
                                            <input type="text" name="permission" class="form-control" id="permission" placeholder="permission.view" value="{% if requestParams.permission %}{{requestParams.permission}}{% else %}{{ route.permission }}{% endif %}">
                                            <span class="help-block">{{ error('permission') }}</span>
                                        </div>
                                        <div class="form-group col-xs-6{% if has_error('status') %} has-error{% endif %}">
                                            <label for="status">Status</label><br />
                                            <input type="checkbox" name="status" id="status" {% if requestParams.status %}checked{% elseif route.status %}checked{% endif %} data-toggle="toggle" data-on="Enabled" data-off="Disabled" data-onstyle="success" data-offstyle="danger" data-width="100%">
                                            <span class="help-block">{{ error('status') }}</span>
                                        </div>
                                        <div class="form-group col-xs-12{% if has_error('roles') %} has-error{% endif %}">
                                            <label for="roles">Limit to Roles</label>
                                            <select name="roles[]" id="roles" class="form-control" placeholder="Select Roles" multiple="multiple">
                                                {% for role in roles %}
                                                    <option value="{{role.id}}" {% if role.id in route.roles.pluck('id') %}selected{% endif %}>{{role.name}}</option>
                                                {% endfor %}
                                            </select>
                                            <span class="help-block">{{ error('roles') }}</span>
                                        </div>
                                    </div>
                                    <div class="form-group{% if has_error('css') %} has-error{% endif %}">
                                        <label for="css">Custom CSS</label>
                                        <textarea name="css" class="form-control" id="css" placeholder="Custom CSS" value="{% if requestParams.css %}{{requestParams.css}}{% else %}{{ route.css }}{% endif %}"></textarea>
                                        <span class="help-block">{{ error('css') }}</span>
                                    </div>
                                    <div class="form-group{% if has_error('js') %} has-error{% endif %}">
                                        <label for="js">Custom Javascript</label>
                                        <textarea name="js" class="form-control" id="js" placeholder="Custom Javascript" value="{% if requestParams.js %}{{requestParams.js}}{% else %}{{ route.js }}{% endif %}"></textarea>
                                        <span class="help-block">{{ error('js') }}</span>
                                    </div>
                                </div>
                                <div class="col-md-9">
                                    <legend>Content</legend>
                                    <div id="contentRow">{% if requestParams.page_content %}{{requestParams.page_content|raw}}{% else %}{{ route.content|raw }}{% endif %}</div>
                                    <div class="form-group{% if has_error('page_content') %} has-error{% endif %}" style="display: none;">
                                        <textarea name="page_content" class="form-control" id="page_content">{% if requestParams.page_content %}{{requestParams.page_content|raw}}{% else %}{{ route.content|raw }}{% endif %}</textarea>
                                        <span class="help-block">{{ error('page_content') }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {{ csrf() }}
                    </div>
                    <div class="box-footer">
                        <div class="col-md-4 col-md-offset-4">
                            <button type="submit" class="btn btn-success form-control">Update Page</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div style="clear: both"></div>

{% endblock %}

{% block javascript %}
<!-- Select2 Dropdowns -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/js/select2.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/4.7.1/tinymce.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/4.7.1/jquery.tinymce.min.js" type="text/javascript"></script>
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>

<script src="{{ asset('AdminLTE/js/jquery.grideditor.min.js') }}" type="text/javascript"></script>
<script>
    $(document).ready(function() {
        $('#roles').select2({
            width: '100%'
        });
        $('#contentRow').gridEditor({
            tinymce: {
                config: {
                    theme: "modern",
                    height: "300", 
                    paste_data_images: true,
                    plugins: [
                      "advlist autolink lists link charmap print preview hr anchor pagebreak image",
                      "searchreplace wordcount visualblocks visualchars code fullscreen",
                      "insertdatetime nonbreaking save table contextmenu directionality",
                      "emoticons template paste textcolor colorpicker textpattern"
                    ],
                    toolbar1: "undo redo | styleselect forecolor backcolor | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link | code",
                    toolbar2: "media_local cloudinary",
                    bootstrapConfig: {
                        'imagesPath': '/uploads/' // replace with your images folder path
                    },
                    branding: false,
                    convert_urls: false,
                    setup: function (editor) {
                        editor.addButton('media_local', {
                            text: 'Local Media',
                            icon: false,
                            onclick: function () {
                                DappurMedia.loadMedia('blog', 'post_content');
                            }
                        });
                        if(hasCloudinary){
                            editor.addButton('cloudinary', {
                                text: 'Cloudinary',
                                icon: 'false',
                                onclick: function () {
                                    DappurCloudinary.loadCloudinary('blog', 'post_content');
                                }
                            });
                        }
                        
                    }
                }
            }
        });
    });
    $(document).on('submit', 'form', function(e) {
        var html = $('#contentRow').gridEditor('getHtml');
        $('#page_content').val(html);
    });
</script>
{% endblock %}

